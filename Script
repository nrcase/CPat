@echo off
CLS
title CP Service and Local Policy Script
color 0A

if %errorlevel%==0 (
	echo Admin rights granted!
) else (
    echo Failure, no rights
	pause
    exit
)

set /p answer=Have you answered all the forensics questions?[y/n]:
	if /I {%answer%}=={y} (
		goto :menu
	) else (
		echo please go and answer them.
		pause
		exit
	)



:MENU
CLS
ECHO CHHS CyberPatriot Team 1
ECHO Created by Nick Case
ECHO ...............................................
ECHO PRESS 1, 2, 3, 4, 5, 6, 7, 8, 9 OR  to select your task, or 10 to EXIT.
ECHO ...............................................
ECHO.
ECHO 1 - Do Services, enable firewall and disable guest
ECHO 2 - Do Local Security Policy stuff through Security Template
ECHO 3 - Enable Updates
ECHO 4 - Search by File type and generate report
ECHO 5 - Password Policy
ECHO 6 - Lockout Policy
ECHO 7 - Audit Policy
ECHO 8 - Group Assignment
ECHO 9 - Find Common Hacking Tools
ECHO 10 - Exit
ECHO.

SET /P M=Type 1, 2, 3, 4 or 5 then press ENTER:
IF %M%==1 GOTO SERV
IF %M%==2 GOTO LCLP
IF %M%==3 GOTO UPDATE
IF %M%==4 GOTO FILES
IF %M%==5 GOTO PASSP
IF %M%==6 GOTO lockout
IF %M%==7 GOTO Audit
IF %M%==8 GOTO group
IF %M%==9 GOTO Hack
IF %M%==10 GOTO EOF

:Hack
findstr "Cain" programfiles.flashed
if %errorlevel%==0 (
echo Cain detected. Please take note, then press any key.
pause >NUL
)
cls
findstr "nmap" programfiles.flashed
if %errorlevel%==0 (
echo Nmap detected. Please take note, then press any key.
pause >NUL
)
cls
findstr "keylogger" programfiles.flashed
if %errorlevel%==0 (
echo Potential keylogger detected. Please take note, then press any key.
pause >NUL
)
cls
findstr "Armitage" programfiles.flashed
if %errorlevel%==0 (
echo Potential Armitage detected. Please take note, then press any key.
pause >NUL
)
cls
findstr "Metasploit" programfiles.flashed
if %errorlevel%==0 (
echo Potential Metasploit framework detected. Please take note, then press any key.
pause >NUL

ls
findstr "Shellter" programfiles.flashed
if %errorlevel%==0 (
echo Potential Shellter detected. Please take note, then press any key.
pause >NUL
)
cls
goto MENU

:audit
	auditpol /set /category:* /success:enable
	auditpol /set /category:* /failure:enable

	pause
	goto :menu

:lockout
	rem Sets the lockout policy
	echo Setting the lockout policy
	net accounts /lockoutduration:30
	net accounts /lockoutthreshold:3
	net accounts /lockoutwindow:30

	pause
	goto :menu

:passwdPol
	rem Sets the password policy
	rem Set complexity requirments
	echo Setting pasword policies
	net accounts /minpwlen:8
	net accounts /maxpwage:60
	net accounts /minpwage:10
	net accounts /uniquepw:3
pause
	goto :menu


:SERV
REM Guest
net user guest /active:no

REM Enables UAC
reg ADD HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System /v EnableLUA /t REG_DWORD /d 1 /f

REM
Firewall
netsh advfirewall set allprofiles state 
netsh advfirewall firewall set rule name="Remote Assistance (DCOM-In)" new enable=no >NUL
netsh advfirewall firewall set rule name="Remote Assistance (PNRP-In)" new enable=no >NUL
netsh advfirewall firewall set rule name="Remote Assistance (RA Server TCP-In)" new enable=no >NUL
netsh advfirewall firewall set rule name="Remote Assistance (SSDP TCP-In)" new enable=no >NUL
netsh advfirewall firewall set rule name="Remote Assistance (SSDP UDP-In)" new enable=no >NUL
netsh advfirewall firewall set rule name="Remote Assistance (TCP-In)" new enable=no >NUL
netsh advfirewall firewall set rule name="Telnet Server" new enable=no >NUL
netsh advfirewall firewall set rule name="netcat" new enable=no >NUL


REM Telnet
DISM /online /disable-feature /featurename:TelnetClient 
DISM /online /disable-feature /featurename:TelnetServer
sc stop "TlntSvr"
sc config "TlntSvr" start= disabled

REM UPnP Device Host
sc stop "upnphost"
sc config "upnphost" start = disabled

REM SNMP Trap
sc stop "SNMPTRAP"
sc config "SNMPTRAP" start = disabled

REM Windows Event Collector and Log
sc start "Wecsvc"
sc config "Wecsvc" start = auto
sc start "EventLog"
sc config "EventLog" start = auto

REM Print Spooler
sc stop "Spooler"
sc config "Spooler" start = disabled

REM SSDP Discovery
sc stop "SSDPSRV"
sc config "SSDPSRV" start = disabled

REM TCP/IP NetBIOS Helper
sc stop "lmhosts"
sc config "lmhosts" start = disabled

REM Telephony
sc stop "TapiSrv"
sc config "TapiSrv" start = disabled

REM From pervious scipt
sc stop TapiSrv
sc config TapiSrv start= disabled

sc stop ftpsvc
sc config ftpsvc start= disabled

sc stop SharedAccess
sc config SharedAccess start= disabled

sc stop SSDPSRV
sc config SSDPSRV start= disabled

sc stop remoteAccess
sc config remoteAccess start= disabled

sc stop HomeGroupProvider
sc config HomeGroupProvider start= disabled

sc stop HomeGroupListener
sc config HomeGroupListener start= disabled

REM More Stuff!
dism /online /disable-feature /featurename:IIS-WebServerRole
dism /online /disable-feature /featurename:IIS-WebServer
dism /online /disable-feature /featurename:IIS-CommonHttpFeatures
dism /online /disable-feature /featurename:IIS-HttpErrors
dism /online /disable-feature /featurename:IIS-HttpRedirect
dism /online /disable-feature /featurename:IIS-ApplicationDevelopment
dism /online /disable-feature /featurename:IIS-NetFxExtensibility
dism /online /disable-feature /featurename:IIS-NetFxExtensibility45
dism /online /disable-feature /featurename:IIS-HealthAndDiagnostics
dism /online /disable-feature /featurename:IIS-HttpLogging
dism /online /disable-feature /featurename:IIS-LoggingLibraries
dism /online /disable-feature /featurename:IIS-RequestMonitor
dism /online /disable-feature /featurename:IIS-HttpTracing
dism /online /disable-feature /featurename:IIS-Security
dism /online /disable-feature /featurename:IIS-URLAuthorization
dism /online /disable-feature /featurename:IIS-RequestFiltering
dism /online /disable-feature /featurename:IIS-IPSecurity
dism /online /disable-feature /featurename:IIS-Performance
dism /online /disable-feature /featurename:IIS-HttpCompressionDynamic
dism /online /disable-feature /featurename:IIS-WebServerManagementTools
dism /online /disable-feature /featurename:IIS-ManagementScriptingTools
dism /online /disable-feature /featurename:IIS-IIS6ManagementCompatibility
dism /online /disable-feature /featurename:IIS-Metabase
dism /online /disable-feature /featurename:IIS-HostableWebCore
dism /online /disable-feature /featurename:IIS-StaticContent
dism /online /disable-feature /featurename:IIS-DefaultDocument
dism /online /disable-feature /featurename:IIS-DirectoryBrowsing
dism /online /disable-feature /featurename:IIS-WebDAV
dism /online /disable-feature /featurename:IIS-WebSockets
dism /online /disable-feature /featurename:IIS-ApplicationInit
dism /online /disable-feature /featurename:IIS-ASPNET
dism /online /disable-feature /featurename:IIS-ASPNET45
dism /online /disable-feature /featurename:IIS-ASP
dism /online /disable-feature /featurename:IIS-CGI
dism /online /disable-feature /featurename:IIS-ISAPIExtensions
dism /online /disable-feature /featurename:IIS-ISAPIFilter
dism /online /disable-feature /featurename:IIS-ServerSideIncludes
dism /online /disable-feature /featurename:IIS-CustomLogging
dism /online /disable-feature /featurename:IIS-BasicAuthentication
dism /online /disable-feature /featurename:IIS-HttpCompressionStatic
dism /online /disable-feature /featurename:IIS-ManagementConsole
dism /online /disable-feature /featurename:IIS-ManagementService
dism /online /disable-feature /featurename:IIS-WMICompatibility
dism /online /disable-feature /featurename:IIS-LegacyScripts
dism /online /disable-feature /featurename:IIS-LegacySnapIn
dism /online /disable-feature /featurename:IIS-FTPServer
dism /online /disable-feature /featurename:IIS-FTPSvc
dism /online /disable-feature /featurename:IIS-FTPExtensibility
dism /online /disable-feature /featurename:TFTP
dism /online /disable-feature /featurename:TelnetClient
dism /online /disable-feature /featurename:TelnetServer


ECHO Do you want Remote Desktop?
SET /P YN= Type 1 for YES or 2 for NO then press Enter
if %YN%==1 GOTO MENU

REM Remote Desktop
sc stop "TermService"
sc config "TermService" start=disabled
sc stop "SessionEnv"
sc config "SessionEnv" start=disabled
sc stop "UmRdpService"
sc config "UmRdpService" start = disabled
sc stop "RemoteRegistry"
sc config "RemoteRegistry" start = disabled
reg add "HKLM\SYSTEM\CurrentControlSet\Control\Terminal Server" /v fDenyTSConnections /t REG_DWORD /d 1 /f


pause
GOTO MENU

:LCLP
Secedit /configure /db secedit.sdb /cfg "C:\Desktop\CPScript" /overwrite  /silent
Secedit /refreshpolicy machine_policy /enforce /quiet
pause
GOTO MENU

:UPDATE
REM Enables Updates
reg add "HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\WindowsUpdate\Auto Update" \v AUOptions \t REG_DWORD \d 4 /f
pause
GOTO MENU

:FILES
set "extension=dir"
set "path=dir"
set "Target=dir"
set "report=dir"

:Path1
set/p "path=Enter Path to search (C:\Users): "
goto :Extension1

:Extension1
echo.
set/p "extension=Enter Extension (*.jpg, *.png, *.wav, *.mp3, *.mp4): "
goto :report

:report
echo.
set/p "report=Enter Report name (jpgExtension.txt): "
goto :Target

:Target
echo.
set/p "Target=Enter target of generated report: "
%@Try%
goto :Print1
cd %path%
%@EndTry%
:@Catch
GOTO Target
:@EndCatch

:Print1

dir/s /a %extension% > "%Target%\%report%"
echo.
echo.
echo A report of all files of the specified extension and location can be found 
echo in the specified target.
echo.
start %Target%\%report%
pause
GOTO MENU

:group
	cls
	net localgroup
	set /p grp=What group would you like to check?:
	net localgroup !grp!
	set /p answer=Is there a user you would like to add or remove?[add/remove/back]:
	if "%answer%"=="add" (
		set /p userAdd=Please enter the user you would like to add:
		net localgroup !grp! !userAdd! /add
		echo !userAdd! has been added to !grp!
	)
	if "%answer%"=="remove" (
		set /p userRem=Please enter the user you would like to remove:
		net localgroup !grp! !userRem! /delete
		echo !userRem! has been removed from !grp!
	)
	if "%answer%"=="back" (
		goto :group
	)

	set /p answer=Would you like to go check again?[y/n]
	if /I "%answer%"=="y" (
		goto :group
	)
	if /I "%answer%"=="n" (
		goto :menu
	)


:EOF
pause
